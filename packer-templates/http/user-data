#cloud-config
autoinstall:
  version: 1
  locale: en_US
  keyboard:
    layout: en
    variant: us
  manage_resolv_conf: true
  resolv_conf:
    nameservers: ['8.8.4.4', '8.8.8.8']
  write_files:
  - path: /etc/sysctl.d/10-disable-ipv6.conf
    permissions: 0644
    owner: root
    content: |
      net.ipv6.conf.eth0.disable_ipv6 = 1
  storage:
    layout:
      name: direct
  apt:
    primary:
      - arches: [amd64]
        uri: "https://mirrors.tuna.tsinghua.edu.cn/ubuntu/"
  package_update: true
  package_upgrade: true
  identity:
    hostname: ubuntu-server
    username: ubuntu
    password: lrzkz89JCrvzOPr56aXfFFqGZpBReOx5ndDu9m5CwVFWjZsEIhvVm.I5B4zMxJdcdTyAvncwjKT.dWcD/ZHIo. # ubuntu
  refresh-installer:
    update: false
  ssh:
    install-server: yes
    allow-pw: false
    authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDYfbG8ekG7LdIDkUM6WGAwJ8MtZYiaN4Jq4FEkp6F5Zek+1gy6MU9lA5WE2knzGDl3Upy09XyJ9LLO65q4q6pDeDussm2R4sOQXK3x9AoUZnd6m+PNaxeclKNEAqQed74qGVmI0CefTtMjIyPAYVVL/EfWuY3O+8M+I5wF5mQfVQNF9q18MRgtzhqFvrvGv2KCm23Id5UitHc8AMew6KhSdVVW0yTQignNbMDfaV0bbVmzNkwGeU2EC/Bll/V8AsfZXgsl0cNXo8wL5I01cCpHcgx33CjKRgb/N8JIEn1wCkSaucpY4ZOZFR7jD+JWy3NIfL1jH5TnjYo4+sWbqRz2CtiGPxv9TyDA6hJSPIKjKhiheXrOTrq9f5uThd1I9bRsSLS8Feg9/ANKkuf0XBl/NzXvmlo1M6mbpfVUzmIU8/tP0mzu2zZgO5xHQgIODUYax6IeH5YPPRB8YGYLp2yUCS6AuuYgMZRruuhbs64FSTH4t0NlZXkwGdhp3qIQyos= kev@archlinux
  user-data:
    disable_root: false
  packages:
    - linux-generic
    - linux-headers-generic
    - linux-image-generic
    - iputils-ping
    - telnet
    - dnsutils
    - vim
    - openssh-server
    - curl
    - wget
    - tmux
    - qemu-guest-agent
    - neofetch
    - cloud-init
  late-commands:
    - echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' > /target/etc/sudoers.d/ubuntu
    - curtin in-target --target=/target -- chmod 440 /etc/sudoers.d/ubuntu
